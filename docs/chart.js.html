<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: service/chart.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: service/chart.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

fruskac.Chart = (function () {

    /**
     * @global
     * @param {HTMLDomElement} container
     * @constructor
     */
    function Chart(container) {
        var self = this;
        self.visible = false;
        self.container = container;

        $(self.container)
            .append('&lt;button onclick="chart.setVisible(false)">X&lt;/button>')
            .append('&lt;div id="chart_content">&lt;/div>');

    }

    /**
     * @global
     */
    Chart.prototype = {

        /**
         * Set chart container visibility
         *
         * @param {boolean} value
         */
        setVisible: function (value) {

            var self = this;

            self.visible = value;

            var className = 'on';

            if (self.visible) {
                $(self.container).addClass(className);
            } else {
                $(self.container).removeClass(className);
            }

            var center = gmap.getCenter();
            google.maps.event.trigger(gmap, "resize");
            gmap.setCenter(center);

        },

        /**
         * Show chart
         *
         * @param {Array} points
         */
        show: function (points) {

            var self = this;

            self.setVisible(true);

            var elevator = new google.maps.ElevationService;

            // Load the Visualization API and the corechart package.
            google.charts.load('current', {'packages': ['corechart']});

            // Set a callback to run when the Google Visualization API is loaded.
            google.charts.setOnLoadCallback(function () {
                getPathElevation(points, elevator, function (rows) {

                    // Create the data table.
                    var data = new google.visualization.DataTable();
                    data.addColumn('number', 'Distance');
                    data.addColumn('number', 'Elevation');
                    data.addRows(rows);

                    // Set chart options
                    var options = {
                        lineWidth: 5,
                        focusTarget: 'category',
                        hAxis: {
                            title: 'Distance (km)'
                        },
                        vAxis: {
                            title: 'Elevation (m)',
                            minValue: 0
                        },
                        legend: {
                            position: "none"
                        }
                    };

                    // Instantiate and draw our chart, passing in some options.
                    var chart = new google.visualization.AreaChart(document.getElementById('chart_content'));
                    chart.draw(data, options);

                    google.visualization.events.addListener(chart, 'onmouseover', function (coords) {
                        map.placeMarker(points.getAt(coords.row))
                    });

                    $(window).on('resize', function () {
                        chart.draw(data, options);
                    });

                });
            });

        }
    };


    /**
     *
     * @param {Object[]} points
     * @param {google.maps.ElevationService} elevator
     * @param {Function} callback
     */
    function getPathElevation(points, elevator, callback) {

        var gpath = [];
        points.forEach(function (point) {
            gpath.push(point)
        });

        // Create a PathElevationRequest object using this array.
        elevator.getElevationAlongPath({
            'path': gpath,
            'samples': gpath.length
        }, function (elevations) {
            var distance = 0;
            var rows = [];
            elevations.forEach(function (e, index) {
                var distanceFromPrevious;
                if (index) {
                    distanceFromPrevious = getDistance(elevations[index].location, elevations[index - 1].location)
                } else {
                    distanceFromPrevious = 0;
                }
                distance += parseFloat(distanceFromPrevious);
                rows.push([distance, e.elevation]);
            });
            callback(rows);
        });
    }

    /**
     * calculates distance between two points in km's
     *
     * @param {google.maps.LatLng} p1
     * @param {google.maps.LatLng} p2
     * @returns {string}
     */
    function getDistance(p1, p2) {
        var R = 6378137; // Earthâ€™s mean radius in meter
        var dLat = rad(p2.lat() - p1.lat());
        var dLong = rad(p2.lng() - p1.lng());
        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(rad(p1.lat())) * Math.cos(rad(p2.lat())) *
            Math.sin(dLong / 2) * Math.sin(dLong / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c;
        return (d / 1000).toFixed(2); // "d" returns the distance in meter
        //return (google.maps.geometry.spherical.computeDistanceBetween(p1, p2) / 1000).toFixed(2);
    }

    /**
     *
     * @param {number} x
     * @returns {number}
     */
    function rad(x) {
        return x * Math.PI / 180;
    }

    return Chart;

})();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Chart.html">Chart</a></li><li><a href="Kml.html">Kml</a></li><li><a href="Map.html">Map</a></li><li><a href="Marker.html">Marker</a></li><li><a href="Storage.html">Storage</a></li><li><a href="Track.html">Track</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Mon Feb 27 2017 20:06:17 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
