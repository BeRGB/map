!function(e,t,n,r){"use strict";function a(){}a.prototype=a,a.Util=function(){function t(){}return t.prototype={getParameterByName:function(t,n){n||(n=e.location.href),t=t.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),a=r.exec(n);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},getParameterPartsByName:function(e){var t=this.getParameterByName(e);if(t)return t.split(",")}},t}(),a.I18N={LANGUAGES:["en","rs"],SOURCE:{DISTANCE:[{en:"Distance"},{rs:"Udaljenost"}],ELEVATION:[{en:"Elevation"},{rs:"Visina"}]}},a.PARAMETER={FOCUS:"f",COORDINATES:"c",TRACK:"t",LAYERS:"l"},a.TYPE={MARKER:"marker",TRACK:"track",KML:"kml"},function(e){e.maps.Polyline.prototype.getBounds=function(){var t=new e.maps.LatLngBounds;return this.getPath().forEach(function(n){t.extend(new e.maps.LatLng(n.lat(),n.lng()))}),t}}(n),a.Marker=function(){function e(e){return e=_.extend({map:f},e),e.icon&&e.icon.hasOwnProperty("url")&&(e.icon=new n.maps.MarkerImage(e.icon.url,new n.maps.Size(e.icon.width,e.icon.height),new n.maps.Point(e.icon.x,e.icon.y))),function(){var r=new n.maps.Marker(e);return n.maps.event.addListener(r,"click",function(){m.showInfoWindow(t(e.data),this)}),r}()}function t(e){var t="<h1>"+e.title+"</h1>";return e.description&&(t+="<p>"+e.description+"</p>"),e.image&&(t+='<img src="'+e.image+'">'),e.link&&(t+='<a href="'+e.link+'" target="_blank">'+e.link+"</a>"),t}return e}(),a.Track=function(){function e(e){return e=_.extend({map:f,geodesic:!0,strokeColor:"rgb(51, 102, 204)",strokeOpacity:1,strokeWeight:4},e),function(){return new n.maps.Polyline(e)}()}return e}(),a.Kml=function(){function e(e,t){return t=_.extend({map:f,preserveViewport:!0,suppressInfoWindows:!0,data:{type:"kml"}},t),function(){return new n.maps.KmlLayer(e,t)}()}return e}(),a.I18n=function(){function e(e){this.lang=e,Object.keys(a.I18N.SOURCE).forEach(function(e){t(e,a.I18N.SOURCE[e])})}function t(e,t){t.forEach(function(t){a.I18N.LANGUAGES.forEach(function(r){t[r]&&(n[r]||(n[r]={}),n[r][e]=t[r])})})}var n={};return e.prototype={translate:function(e){return n[this.lang]&&n[this.lang][e]||"__TRANSLATION_MISSING__"}},e}(),a.Chart=function(){function r(e){var t=this;t.visible=!1,t.container=e}function i(e,t,n){var r=[];e.forEach(function(e){r.push(e)}),t.getElevationAlongPath({path:r,samples:r.length},function(e){var t=0,r=[];e.forEach(function(n,a){var i;i=a?s(e[a].location,e[a-1].location):0,t+=parseFloat(i),r.push([t,n.elevation])}),n(r)})}function s(e,t){var n=6378137,r=c(t.lat()-e.lat()),a=c(t.lng()-e.lng()),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(c(e.lat()))*Math.cos(c(t.lat()))*Math.sin(a/2)*Math.sin(a/2),o=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),s=n*o;return(s/1e3).toFixed(2)}function c(e){return e*Math.PI/180}return r.prototype={setVisible:function(e){var r=this;r.visible=e;var a="on";r.visible?t(r.container).addClass(a):t(r.container).removeClass(a);var i=f.getCenter();n.maps.event.trigger(f,"resize"),f.setCenter(i)},show:function(r,s){var c=this;c.setVisible(!0),s&&t(c.container).find("button").remove();var u=new n.maps.ElevationService;n.charts.load("current",{packages:["corechart"],language:a.lang}),n.charts.setOnLoadCallback(function(){i(r,u,function(a){var i=new n.visualization.DataTable;i.addColumn("number",o.translate("DISTANCE")),i.addColumn("number",o.translate("ELEVATION")),i.addRows(a);var s={lineWidth:5,focusTarget:"category",hAxis:{title:o.translate("DISTANCE")+" (km)"},vAxis:{title:o.translate("ELEVATION")+" (m)",minValue:0},legend:{position:"none"}},c=new n.visualization.AreaChart(document.getElementById("chart"));c.draw(i,s),n.visualization.events.addListener(c,"onmouseover",function(e){m.placeMarker(r.getAt(e.row))}),t(e).on("resize",function(){c.draw(i,s)})})})}},e.closeChart=function(){v.setVisible(!1)},r}(),a.Map=function(){function o(r){this.infoWindow=new n.maps.InfoWindow({content:"holding..."}),(a.isCrossDomain||e.frameElement&&e.frameElement.hasAttribute("allowFullScreen"))&&t("#map_container > button").show()}function s(e){if(e)return e.hasOwnProperty("position")?a.TYPE.MARKER:e.hasOwnProperty("strokeColor")?a.TYPE.TRACK:e.hasOwnProperty("suppressInfoWindows")?a.TYPE.KML:void 0}return o.prototype={add:function(e,t,n){var i=this;return new r(function(r){switch(t){case a.TYPE.MARKER:return i.addMarker(e,n).then(function(e){r(e)});case a.TYPE.TRACK:return i.addTrack(e,n).then(function(e){r(e)});case a.TYPE.KML:return i.addKml(e,n).then(function(e){r(e)})}})},addMarker:function(e,t){return new r(function(r){var i=new a.Marker({position:new n.maps.LatLng(e.lat,e.lng),title:e.data.title,icon:e.options.icon_data,data:e.data});i.setVisible(t),t&&g.addMarker(i),r(i)})},addTrack:function(e,i){var o;return o="string"==typeof e?e:"../"+e.url,new r(function(e){return t.get(o).then(function(r){var o=[];t(r).find("trkpt").each(function(e,r){var a=Number(t(this).attr("lat")),i=Number(t(this).attr("lon")),s=new n.maps.LatLng(a,i);o.push(s)});var s=new a.Track({path:o});s.setVisible(i),e(s)})})},addKml:function(e,t){return new r(function(n){var r=new a.Kml(e.url);t||r.setMap(null),n(r)})},setVisible:function(e,t){switch(s(e)){case a.TYPE.MARKER:e.setVisible(t),t?g.addMarker(e):g.removeMarker(e);break;case a.TYPE.TRACK:e.setVisible(t);break;case a.TYPE.KML:e.setMap(t?f:null)}},focus:function(e,t){switch(s(e)){case a.TYPE.MARKER:f.setZoom(14),f.panTo(e.position),e.setAnimation(n.maps.Animation.BOUNCE);break;case a.TYPE.TRACK:f.fitBounds(e.getBounds()),v.show(e.getPath(),t)}},placeMarker:function(e){var t=this;t.marker?t.marker.animateTo(e,{duration:50}):t.marker=new a.Marker({position:e})},showInfoWindow:function(e,t){var n=this;n.infoWindow.setContent(e),n.infoWindow.open(f,t)},fullscreen:function(){var t={c:f.getCenter().lat()+","+f.getCenter().lng()+","+f.getZoom(),l:i.getParameterByName(a.PARAMETER.LAYERS),f:i.getParameterByName(a.PARAMETER.FOCUS),lang:a.lang},n="/fruskac/map/examples/angularjs.html#!?"+Object.keys(t).map(function(e){return t[e]&&encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");e.open(n,"_blank")}},e.fullscreen=function(){m.fullscreen()},o}(),a.Storage=function(){function e(e){e||(e=[]),this.data=e}function t(e){if(e=a(e),n(e)){var t=e.split(":");return t.splice(-1),t.join(":")}}function n(e){return e=a(e),e.indexOf(":")!==-1}function a(e){return _.isArray(e)&&(e=e.join(":")),e}function i(e,t){t=a(t);var n=[];return e.forEach(function(e){if(e.id){var r;r=t?a([t,e.id]):e.id;var o={id:e.id,getVisible:function(){return s.getState(r)},setVisible:function(e){return s.setState(r,e)},select:function(){return s.focus(r)}};if(e.type&&(o.type=e.type),e.children&&e.children.length){var c=i(e.children,r);c&&c.length&&(o.children=c)}n.push(o)}}),n}return e.prototype={add:function(e,t,n,i){var o=this;t=a(t);var s;if(t){var c=o.get(t);c&&(c.children||(c.children=[]),s=c.children)}else s=o.data;return n?(c.type=n,m.add(e,n,i).then(function(e){s.push(e)})):new r(function(t){s.push(e),t(e)})},root:function(){return this.data},get:function(e,t){if(e=a(e),t||(t=this.data),e){if(e.indexOf(":")!==-1){var n=e.split(":"),t=_.find(t,{id:n[0]}).children;return n=n.splice(1),this.get(n.join(":"),t)}return _.find(t,function(t){if(t&&t.id===e||t.hasOwnProperty("data")&&t.data.id==e)return t})}},query:function(e,t){e=a(e),t||(t=this.data);var n=this.get(e,t);return n.children},setState:function(e,t){e=a(e);var n=this.get(e);n&&(n.on=t,this.setVisible(e,t))},getState:function(e){e=a(e);var t=this.get(e);if(t)return t.on},setVisible:function(e,t){e=a(e);var n=this,r=this.get(e);r&&(r.visible=t,r.children&&r.children.forEach(function(a){if(a.id)n.setVisible([e,a.id],t);else{var i=!!t&&r.on;m.setVisible(a,i)}}))},getVisible:function(e){e=a(e);var r=this.get(e),i=!0;if(r&&(i=r.visible,n(e))){var o=t(e),s=this.getVisible(o);if(!s)return!1;if(n(o))return this.getVisible(t(o))}return i},focus:function(e,r){var i=this;e=a(e);var o=i.get(e);if(n(e)){var s=i.get(t(e));i.setState(s.id,!0),s.children.forEach(function(e){e.hasOwnProperty("id")&&i.setState([s.id,e.id],e.id===o.id)})}m.focus(o&&o.hasOwnProperty("children")?o.children[0]:o,r)},getSelectors:function(){return i(s.root())}},e}(),a.Loader=function(){function e(){}function n(e,n,a){return"string"==typeof e&&(e={name:e.replace(/-\w{2}/,""),url:"../data/"+e+".json"}),s.add({id:e.name,visible:a,on:a}).then(function(){return t.get(e.url).success(function(t){var i=[];return t.forEach(function(t){var o,c=s.get([e.name,t.tag]);o=c?new r(function(e){e()}):s.add({id:t.tag,visible:a,on:a,type:n},e.name),o.then(function(){s.add(t,[e.name,t.tag],n,a)}),i.push(o)}),r.all(i)})})}return e.prototype={load:function(e){var t=[];return e.forEach(function(e){t.push(n.apply(this,e))}),r.all(t)},append:function(e,t){return m.add(e,t,!0)}},e}(),a.Api=function(){function e(){}return e.prototype={ready:function(e){e()},getData:function(){return s.getSelectors()},clustering:function(e){return void 0===e?g.enabled:(g.enabled=e,e?(g.setMaxZoom(null),g.setGridSize(50)):(g.setMaxZoom(1),g.setGridSize(1)),g.resetViewport(),g.redraw(),void 0)},type:function(e){return void 0===e?f.getMapTypeId():f.setMapTypeId(e)}},e}(),e.fruskac=new a.Api;var i=new a.Util;a.isCrossDomain=e.self!==e.top&&document.referrer&&!new RegExp("//"+document.domain).test(document.referrer),a.lang=i.getParameterByName("lang")||e.self!==e.top&&e.top.document.documentElement.lang||"en";var o=new a.I18n(a.lang),s=new a.Storage,c={center:new n.maps.LatLng(45.167031,19.69677),zoom:11,mapTypeId:n.maps.MapTypeId.TERRAIN,mapTypeControl:!1,zoomControlOptions:{position:n.maps.ControlPosition.LEFT_BOTTOM},streetViewControlOptions:{position:n.maps.ControlPosition.LEFT_BOTTOM}},u=i.getParameterByName(a.PARAMETER.COORDINATES);if(u){var l=i.getParameterPartsByName(a.PARAMETER.COORDINATES);l&&l.length&&(l[0]&&l[1]&&(c.center=new n.maps.LatLng(l[0],l[1])),l[2]&&(c.zoom=parseFloat(l[2])))}var f=new n.maps.Map(document.getElementById("map"),c),d={north:45.166508,south:45.136001,east:19.767672,west:19.681498},p={opacity:.8,clickable:!1},h=new n.maps.GroundOverlay("http://fruskac.net/sites/all/themes/fruskac/css/img/fruskac-logo-map.png",d,p);h.setMap(f);var m=new a.Map(f),g=new MarkerClusterer(f,[],{maxZoom:12,gridSize:50,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"});g.enabled=!0;var v=new a.Chart(document.getElementById("chart_container")),E=[{source:"locations-"+a.lang,type:a.TYPE.MARKER,visible:!0},{source:"marathon",type:a.TYPE.TRACK,visible:!1},{source:"protection",type:a.TYPE.KML,visible:!1},{source:"time",type:a.TYPE.MARKER,visible:!1}],w=[],T=i.getParameterPartsByName(a.PARAMETER.LAYERS);E.forEach(function(e){T&&(e.visible=T.indexOf(e.name)!==-1),w.push(Object.values(e))});var y=i.getParameterByName(a.PARAMETER.TRACK),A=new a.Loader,M=i.getParameterByName(a.PARAMETER.FOCUS);A.load(w).then(function(){y&&A.append(y,a.TYPE.TRACK).then(function(e){n.maps.event.addListenerOnce(f,"idle",function(){m.focus(e)})}),M&&n.maps.event.addListenerOnce(f,"idle",function(){s.focus(M,!0)})})}(window,jQuery,google,Promise);
//# sourceMappingURL=map.min.js.map
