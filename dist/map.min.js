!function(t,e,n,r,i,a){"use strict";function o(){}o.prototype=o,o.Util=function(){function e(){}return e.prototype={getParameterByName:function(e,n){n||(n=t.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=r.exec(n);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},getParameterPartsByName:function(t){var e=this.getParameterByName(t);if(e)return e.split(",")}},e}(),o.I18N={LANGUAGES:["en","rs"],SOURCE:{DISTANCE:[{en:"Distance"},{rs:"Udaljenost"}],ELEVATION:[{en:"Elevation"},{rs:"Visina"}]}},o.PARAMETER={FOCUS:"f",COORDINATES:"c",TRACK:"t",LAYERS:"l"},o.TYPE={MARKER:"marker",TRACK:"track",KML:"kml"},function(t){t.maps.Polyline.prototype.getBounds=function(){var e=new t.maps.LatLngBounds;return this.getPath().forEach(function(n){e.extend(new t.maps.LatLng(n.lat(),n.lng()))}),e}}(i),o.Marker=function(){function t(t){return t=r.extend({map:p},t),t.icon&&t.icon.hasOwnProperty("url")&&(t.icon=new i.maps.MarkerImage(t.icon.url,new i.maps.Size(t.icon.width,t.icon.height),new i.maps.Point(t.icon.x,t.icon.y))),function(){var n=new i.maps.Marker(t);return i.maps.event.addListener(n,"click",function(){v.showInfoWindow(e(t.data),this)}),n}()}function e(t){var e="<h1>"+t.title+"</h1>";return t.description&&(e+="<p>"+t.description+"</p>"),t.image&&(e+='<img src="'+t.image+'">'),t.link&&(e+='<a href="'+t.link+'" target="_blank">'+t.link+"</a>"),e}return t}(),o.Track=function(){function t(t){return t=r.extend({map:p,geodesic:!0,strokeColor:"rgb(51, 102, 204)",strokeOpacity:1,strokeWeight:4},t),function(){return new i.maps.Polyline(t)}()}return t}(),o.Kml=function(){function t(t,e){return e=r.extend({map:p,preserveViewport:!0,suppressInfoWindows:!0,data:{type:"kml"}},e),function(){return new i.maps.KmlLayer(t,e)}()}return t}(),o.I18n=function(){function t(t){this.lang=t,Object.keys(o.I18N.SOURCE).forEach(function(t){e(t,o.I18N.SOURCE[t])})}function e(t,e){e.forEach(function(e){o.I18N.LANGUAGES.forEach(function(r){e[r]&&(n[r]||(n[r]={}),n[r][t]=e[r])})})}var n={};return t.prototype={translate:function(t){return n[this.lang]&&n[this.lang][t]||"__TRANSLATION_MISSING__"}},t}(),o.Chart=function(){function r(t){var e=this;e.visible=!1,e.container=t}function a(t,e,n){var r=[];t.forEach(function(t){r.push(t)}),e.getElevationAlongPath({path:r,samples:r.length},function(t){var e=0,r=[];t.forEach(function(n,i){var a;a=i?s(t[i].location,t[i-1].location):0,e+=parseFloat(a),r.push([e,n.elevation])}),n(r)})}function s(t,e){var n=6378137,r=u(e.lat()-t.lat()),i=u(e.lng()-t.lng()),a=Math.sin(r/2)*Math.sin(r/2)+Math.cos(u(t.lat()))*Math.cos(u(e.lat()))*Math.sin(i/2)*Math.sin(i/2),o=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),s=n*o;return(s/1e3).toFixed(2)}function u(t){return t*Math.PI/180}return r.prototype={setVisible:function(t){var e=this;e.visible=t;var r="on";e.visible?n(e.container).addClass(r):n(e.container).removeClass(r);var a=p.getCenter();i.maps.event.trigger(p,"resize"),p.setCenter(a)},show:function(r,s){var u=this;u.setVisible(!0),s&&n(u.container).find("button").remove();var l=new i.maps.ElevationService;i.charts.load("current",{packages:["corechart"],language:o.lang}),i.charts.setOnLoadCallback(function(){a(r,l,function(a){var o=new i.visualization.DataTable;o.addColumn("number",c.translate("DISTANCE")),o.addColumn("number",c.translate("ELEVATION")),o.addRows(a);var s={lineWidth:5,focusTarget:"category",hAxis:{title:c.translate("DISTANCE")+" (km)"},vAxis:{title:c.translate("ELEVATION")+" (m)",minValue:0},legend:{position:"none"}},u=new i.visualization.AreaChart(e.getElementById("chart"));u.draw(o,s),i.visualization.events.addListener(u,"onmouseover",function(t){v.placeMarker(r.getAt(t.row))}),n(t).on("resize",function(){u.draw(o,s)})})})}},t.closeChart=function(){w.setVisible(!1)},r}(),o.Map=function(){function e(e){this.infoWindow=new i.maps.InfoWindow({content:"holding..."}),(o.isCrossDomain||t.frameElement&&t.frameElement.hasAttribute("allowFullScreen"))&&n("#map_container > button").show()}function r(t){if(t)return t.hasOwnProperty("position")?o.TYPE.MARKER:t.hasOwnProperty("strokeColor")?o.TYPE.TRACK:t.hasOwnProperty("suppressInfoWindows")?o.TYPE.KML:void 0}return e.prototype={add:function(t,e,n){var r=this;return new a(function(i){switch(e){case o.TYPE.MARKER:return r.addMarker(t,n).then(function(t){i(t)});case o.TYPE.TRACK:return r.addTrack(t,n).then(function(t){i(t)});case o.TYPE.KML:return r.addKml(t,n).then(function(t){i(t)})}})},addMarker:function(t,e){return new a(function(n){var r=new o.Marker({position:new i.maps.LatLng(t.lat,t.lng),title:t.data.title,icon:t.options.icon_data,data:t.data});r.setVisible(e),e&&E.addMarker(r),n(r)})},addTrack:function(t,e){var r;return r="string"==typeof t?t:"../"+t.url,new a(function(t){return n.get(r).then(function(r){var a=[];n(r).find("trkpt").each(function(t,e){var r=Number(n(this).attr("lat")),o=Number(n(this).attr("lon")),s=new i.maps.LatLng(r,o);a.push(s)});var s=new o.Track({path:a});s.setVisible(e),t(s)})})},addKml:function(t,e){return new a(function(n){var r=new o.Kml(t.url);e||r.setMap(null),n(r)})},setVisible:function(t,e){switch(r(t)){case o.TYPE.MARKER:t.setVisible(e),e?E.addMarker(t):E.removeMarker(t);break;case o.TYPE.TRACK:t.setVisible(e);break;case o.TYPE.KML:t.setMap(e?p:null)}},focus:function(t,e){switch(r(t)){case o.TYPE.MARKER:p.setZoom(14),p.panTo(t.position),t.setAnimation(i.maps.Animation.BOUNCE);break;case o.TYPE.TRACK:p.fitBounds(t.getBounds()),w.show(t.getPath(),e)}},placeMarker:function(t){var e=this;e.marker?e.marker.animateTo(t,{duration:50}):e.marker=new o.Marker({position:t})},showInfoWindow:function(t,e){var n=this;n.infoWindow.setContent(t),n.infoWindow.open(p,e)},fullscreen:function(){var e={c:p.getCenter().lat()+","+p.getCenter().lng()+","+p.getZoom(),l:s.getParameterByName(o.PARAMETER.LAYERS),f:s.getParameterByName(o.PARAMETER.FOCUS),lang:o.lang},n="/fruskac/map/examples/angularjs.html#!?"+Object.keys(e).map(function(t){return e[t]&&encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");t.open(n,"_blank")}},t.fullscreen=function(){v.fullscreen()},e}(),o.Storage=function(){function t(t){t||(t=[]),this.data=t}function e(t){if(t=i(t),n(t)){var e=t.split(":");return e.splice(-1),e.join(":")}}function n(t){return t=i(t),t.indexOf(":")!==-1}function i(t){return t&&"string"!=typeof t&&(t=t.join(":")),t}function o(t,e){e=i(e);var n=[];return t.forEach(function(t){if(t.id){var r;r=e?i([e,t.id]):t.id;var a={id:t.id,getVisible:function(){return u.getState(r)},setVisible:function(t){return u.setState(r,t)},select:function(){return u.focus(r)}};if(t.type&&(a.type=t.type),t.children&&t.children.length){var s=o(t.children,r);s&&s.length&&(a.children=s)}n.push(a)}}),n}return t.prototype={add:function(t,e,n,r){var o=this;e=i(e);var s;if(e){var c=o.get(e);c&&(c.children||(c.children=[]),s=c.children)}else s=o.data;return n?(c.type=n,v.add(t,n,r).then(function(t){s.push(t)})):new a(function(e){s.push(t),e(t)})},root:function(){return this.data},get:function(t,e){if(t=i(t),e||(e=this.data),t){if(t.indexOf(":")!==-1){var n=t.split(":"),e=r.find(e,{id:n[0]}).children;return n=n.splice(1),this.get(n.join(":"),e)}return r.find(e,function(e){if(e&&e.id===t||e.hasOwnProperty("data")&&e.data.id==t)return e})}},query:function(t,e){t=i(t),e||(e=this.data);var n=this.get(t,e);return n.children},setState:function(t,e){t=i(t);var n=this.get(t);n&&(n.on=e,this.setVisible(t,e))},getState:function(t){t=i(t);var e=this.get(t);if(e)return e.on},setVisible:function(t,e){t=i(t);var n=this,r=this.get(t);r&&(r.visible=e,r.children&&r.children.forEach(function(i){if(i.id)n.setVisible([t,i.id],e);else{var a=!!e&&r.on;v.setVisible(i,a)}}))},getVisible:function(t){t=i(t);var r=this.get(t),a=!0;if(r&&(a=r.visible,n(t))){var o=e(t),s=this.getVisible(o);if(!s)return!1;if(n(o))return this.getVisible(e(o))}return a},focus:function(t,r){var a=this;t=i(t);var o=a.get(t);if(n(t)){var s=a.get(e(t));a.setState(s.id,!0),s.children.forEach(function(t){t.hasOwnProperty("id")&&a.setState([s.id,t.id],t.id===o.id)})}v.focus(o&&o.hasOwnProperty("children")?o.children[0]:o,r)},getSelectors:function(){return o(u.root())}},t}(),o.Loader=function(){function t(){}function e(t,e,r){return"string"==typeof t&&(t={name:t.replace(/-\w{2}/,""),url:"../data/"+t+".json"}),u.add({id:t.name,visible:r,on:r}).then(function(){return n.get(t.url).success(function(n){var i=[];return n.forEach(function(n){var o,s=u.get([t.name,n.tag]);o=s?new a(function(t){t()}):u.add({id:n.tag,visible:r,on:r,type:e},t.name),o.then(function(){u.add(n,[t.name,n.tag],e,r)}),i.push(o)}),a.all(i)})})}return t.prototype={load:function(t){var n=[];return t.forEach(function(t){n.push(e.apply(this,t))}),a.all(n)},append:function(t,e){return v.add(t,e,!0)}},t}(),o.Api=function(){function t(){}return t.prototype={ready:function(t){t()},getData:function(){return u.getSelectors()},clustering:function(t){return void 0===t?E.enabled:(E.enabled=t,t?(E.setMaxZoom(null),E.setGridSize(50)):(E.setMaxZoom(1),E.setGridSize(1)),E.resetViewport(),E.redraw(),void 0)},type:function(t){return void 0===t?p.getMapTypeId():p.setMapTypeId(t)}},t}(),t.fruskac=new o.Api;var s=new o.Util;o.isCrossDomain=t.self!==t.top&&e.referrer&&!new RegExp("//"+e.domain).test(e.referrer),o.lang=s.getParameterByName("lang")||t.self!==t.top&&t.top.document.documentElement.lang||"en";var c=new o.I18n(o.lang),u=new o.Storage,l={center:new i.maps.LatLng(45.167031,19.69677),zoom:11,mapTypeId:i.maps.MapTypeId.TERRAIN,mapTypeControl:!1,zoomControlOptions:{position:i.maps.ControlPosition.LEFT_BOTTOM},streetViewControlOptions:{position:i.maps.ControlPosition.LEFT_BOTTOM}},f=s.getParameterByName(o.PARAMETER.COORDINATES);if(f){var d=s.getParameterPartsByName(o.PARAMETER.COORDINATES);d&&d.length&&(d[0]&&d[1]&&(l.center=new i.maps.LatLng(d[0],d[1])),d[2]&&(l.zoom=parseFloat(d[2])))}var p=new i.maps.Map(e.getElementById("map"),l),h={north:45.166508,south:45.136001,east:19.767672,west:19.681498},m={opacity:.8,clickable:!1},g=new i.maps.GroundOverlay("http://fruskac.net/sites/all/themes/fruskac/css/img/fruskac-logo-map.png",h,m);g.setMap(p);var v=new o.Map(p),E=new MarkerClusterer(p,[],{maxZoom:12,gridSize:50,styles:[{textColor:"white",url:"http://fruskac.net/sites/all/themes/fruskac/css/img/maps.png",backgroundPosition:"0 -523px",height:32,width:32},{textColor:"white",url:"http://fruskac.net/sites/all/themes/fruskac/css/img/maps.png",backgroundPosition:"0 -443px",height:48,width:48},{textColor:"white",url:"http://fruskac.net/sites/all/themes/fruskac/css/img/maps.png",backgroundPosition:"0 -379px",height:64,width:64}]});E.enabled=!0;var w=new o.Chart(e.getElementById("chart_container")),T=[{source:"locations-"+o.lang,type:o.TYPE.MARKER,visible:!0},{source:"marathon",type:o.TYPE.TRACK,visible:!1},{source:"protection",type:o.TYPE.KML,visible:!1},{source:"time",type:o.TYPE.MARKER,visible:!1}],y=[],A=s.getParameterPartsByName(o.PARAMETER.LAYERS);T.forEach(function(t){A&&(t.visible=A.indexOf(t.name)!==-1),y.push(Object.values(t))});var P=s.getParameterByName(o.PARAMETER.TRACK),k=new o.Loader,M=s.getParameterByName(o.PARAMETER.FOCUS);k.load(y).then(function(){P&&k.append(P,o.TYPE.TRACK).then(function(t){i.maps.event.addListenerOnce(p,"idle",function(){v.focus(t)})}),M&&i.maps.event.addListenerOnce(p,"idle",function(){u.focus(M,!0)})})}(window,document,jQuery,_,google,Promise);
//# sourceMappingURL=map.min.js.map
