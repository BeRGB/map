"use strict";!function(c){c.fruskac={}}(window);
"use strict";!function(r){var a={MARKER:"marker",TRACK:"track",KML:"kml"};r.TYPE=a}(window.fruskac);
"use strict";google.maps.Polyline.prototype.getBounds=function(){var t=new google.maps.LatLngBounds;return this.getPath().forEach(function(n){t.extend(new google.maps.LatLng(n.lat(),n.lng()))}),t};
"use strict";!function(e,a){function r(e){var a="<h1>"+e.title+"</h1>";return e.description&&(a+="<p>"+e.description+"</p>"),e.image&&(a+='<img src="'+e.image+'">'),e.link&&(a+='<a href="'+e.link+'" target="_blank">'+e.link+"</a>"),a}var n=function(e){e=_.extend({map:Map.getMap()},e);var n;switch(e.icon){case"lakes":n="mm_20_purple";break;case"monasteries":n="mm_20_yellow";break;case"misc":n="mm_20_blue";break;case"springs":n="mm_20_white";break;case"picnic-areas":n="mm_20_green";break;case"monuments":n="mm_20_red";break;case"fishponds":n="mm_20_black";break;case"waterfalls":n="mm_20_orange";break;case"lookouts":n="mm_20_gray";break;case"meadows":n="mm_20_brown";break;default:n="mm_20_white"}return e.icon="http://maps.gstatic.com/mapfiles/ridefinder-images/"+n+".png",function(){var n=new a.maps.Marker(e);return a.maps.event.addListener(n,"click",function(){Map.showInfoWindow(r(e.data),this)}),n}()};e.Marker=n}(window.fruskac,google);
"use strict";!function(e){var t=function(e){return e=_.extend({map:Map.getMap(),geodesic:!0,strokeColor:"rgb(51, 102, 204)",strokeOpacity:1,strokeWeight:4},e),function(){return new google.maps.Polyline(e)}()};e.Track=t}(fruskac);
"use strict";!function(e,n){function t(e,t){return t=_.extend({map:Map.getMap(),preserveViewport:!0,suppressInfoWindows:!0,data:{type:"kml"}},t),function(){return new n.maps.KmlLayer(e,t)}()}e.Kml=t}(window.fruskac,google);
"use strict";function ChartService(t){this.visible=!1,this.container=t,this.map=Map.getMap(),$(this.container).append('<button onclick="ChartService.setVisible(false)">X</button>').append('<div id="chart_content"></div>')}function getPathElevation(t,e,a){var n=[];t.forEach(function(t){n.push(t)}),e.getElevationAlongPath({path:n,samples:n.length},function(t){var e=0,n=[];t.forEach(function(a,i){var o;o=i?getDistance(t[i].location,t[i-1].location):0,e+=parseFloat(o),n.push([e,a.elevation])}),a(n)})}function getDistance(t,e){var a=6378137,n=rad(e.lat()-t.lat()),i=rad(e.lng()-t.lng()),o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(rad(t.lat()))*Math.cos(rad(e.lat()))*Math.sin(i/2)*Math.sin(i/2),r=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)),s=a*r;return(s/1e3).toFixed(2)}function rad(t){return t*Math.PI/180}ChartService.prototype={setVisible:function(t){this.visible=t;var e="on";this.visible?$(this.container).addClass(e):$(this.container).removeClass(e);var a=this.map.getCenter();google.maps.event.trigger(this.map,"resize"),this.map.setCenter(a)},show:function(t){ChartService.setVisible(!0);var e=new google.maps.ElevationService;google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){getPathElevation(t,e,function(e){var a=new google.visualization.DataTable;a.addColumn("number","Distance"),a.addColumn("number","Elevation"),a.addRows(e);var n={lineWidth:5,focusTarget:"category",hAxis:{title:"Distance (km)"},vAxis:{title:"Elevation (m)",minValue:0},legend:{position:"none"}},i=new google.visualization.AreaChart(document.getElementById("chart_content"));i.draw(a,n),google.visualization.events.addListener(i,"onmouseover",function(e){Map.placeMarker(t.getAt(e.row))})})})}};
"use strict";var MapService=function(t){this.map=t,this.infoWindow=new google.maps.InfoWindow({content:"holding..."})};MapService.prototype={add:function(t,n,e){var r=this;return new Promise(function(a){switch(n){case fruskac.TYPE.MARKER:return r.addMarker(t,e).then(function(t){a(t)});case fruskac.TYPE.TRACK:return r.addTrack(t,e).then(function(t){a(t)});case fruskac.TYPE.KML:return r.addKml(t,e).then(function(t){a(t)})}})},addMarker:function(t,n){return new Promise(function(e){var r=new fruskac.Marker({position:new google.maps.LatLng(t.lat,t.lng),title:t.data.title,icon:t.tag,data:t.data});r.setVisible(n),Clusterer.addMarker(r),e(r)})},addTrack:function(t,n){return new Promise(function(e){return $.get("../"+t.url).then(function(t){var r=[];$(t).find("trkpt").each(function(t,n){var e=Number($(this).attr("lat")),a=Number($(this).attr("lon")),i=new google.maps.LatLng(e,a);r.push(i)});var a=new fruskac.Track({path:r});a.setVisible(n),e(a)})})},addKml:function(t,n){return new Promise(function(e){var r=new fruskac.Kml(t.url);n||r.setMap(null),e(r)})},setVisible:function(t,n){t.hasOwnProperty("position")?(t.setVisible(n),n?Clusterer.addMarker(t):Clusterer.removeMarker(t)):t.hasOwnProperty("strokeColor")?t.setVisible(n):t.hasOwnProperty("suppressInfoWindows")&&t.setMap(n?this.map:null)},getMap:function(){return this.map},focus:function(t){this.map.fitBounds(t.getBounds()),ChartService.show(t.getPath())},placeMarker:function(t){this.marker?this.marker.animateTo(t,{duration:50}):this.marker=new fruskac.Marker({position:t})},showInfoWindow:function(t,n){this.infoWindow.setContent(t),this.infoWindow.open(this.map,n)}};
"use strict";function StorageService(e){e||(e=[]),this.data=e}function getParentSelector(e){if(e=parseSelector(e),hasParentSelector(e)){var t=e.split(":");return t.splice(-1),t.join(":")}}function hasParentSelector(e){return e=parseSelector(e),e.indexOf(":")!==-1}function parseSelector(e){return _.isArray(e)&&(e=e.join(":")),e}function getSelectorsForContainer(e,t){t=parseSelector(t);var r=[];return e.forEach(function(e){if(e.id){var i;i=t?parseSelector([t,e.id]):e.id;var n={id:e.id,getVisible:function(){return Storage.getState(i)},setVisible:function(e){return Storage.setState(i,e)},select:function(){return Storage.select(i)}};if(e.type&&(n.type=e.type),e.children&&e.children.length){var a=getSelectorsForContainer(e.children,i);a&&a.length&&(n.children=a)}r.push(n)}}),r}StorageService.prototype={add:function(e,t,r,i){var n=this;t=parseSelector(t);var a;if(t){var o=n.get(t);o&&(o.children||(o.children=[]),a=o.children)}else a=n.data;return r?(o.type=r,Map.add(e,r,i).then(function(e){a.push(e)})):new Promise(function(t){a.push(e),t(e)})},root:function(){return this.data},get:function(e,t){if(e=parseSelector(e),t||(t=this.data),e){if(e.indexOf(":")!==-1){var r=e.split(":"),t=_.find(t,{id:r[0]}).children;return r=r.splice(1),this.get(r.join(":"),t)}return _.find(t,{id:e})}},query:function(e,t){e=parseSelector(e),t||(t=this.data);var r=this.get(e,t);return r.children},setState:function(e,t){e=parseSelector(e);var r=this.get(e);r&&(r.on=t,this.setVisible(e,t))},getState:function(e){e=parseSelector(e);var t=this.get(e);if(t)return t.on},setVisible:function(e,t){e=parseSelector(e);var r=this,i=this.get(e);i&&(i.visible=t,i.children&&i.children.forEach(function(n){if(n.id)r.setVisible([e,n.id],t);else{var a=!!t&&i.on;Map.setVisible(n,a)}}))},getVisible:function(e){e=parseSelector(e);var t=this.get(e),r=!0;if(t&&(r=t.visible,hasParentSelector(e))){var i=getParentSelector(e),n=this.getVisible(i);if(!n)return!1;if(hasParentSelector(i))return this.getVisible(getParentSelector(i))}return r},select:function(e){e=parseSelector(e);var t=this.get(e);if(hasParentSelector(e)){var r=Storage.get(getParentSelector(e));Storage.setState(r.id,!0),r.children.forEach(function(e){Storage.setState([r.id,e.id],e.id===t.id)})}Map.focus(t.children[0])},getSelectors:function(){return getSelectorsForContainer(Storage.root())}};
"use strict";function load(e,t,o){var r="../data/"+e+".json";Storage.add({id:e,visible:o,on:o}).then(function(){$.get(r).success(function(r){r.forEach(function(r){var a,n=Storage.get([e,r.tag]);a=n?new Promise(function(e){e()}):Storage.add({id:r.tag,visible:o,on:o,type:t},e),a.then(function(){Storage.add(r,[e,r.tag],t,o)})})})})}var Storage=new StorageService,Map=new MapService(new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(45.167031,19.69677),zoom:10,mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}})),Clusterer=new MarkerClusterer(Map.getMap(),[],{gridSize:50,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"});Clusterer.enabled=!0;var ChartService=new ChartService(document.getElementById("chart"));load("locations",fruskac.TYPE.MARKER,!0),load("marathon",fruskac.TYPE.TRACK,!0),load("protection",fruskac.TYPE.KML,!0),load("time",fruskac.TYPE.MARKER,!0),window.FruskacMap={ready:function(e){e()},getData:function(){return Storage.getSelectors()},clustering:function(e){return void 0===e?Clusterer.enabled:(Clusterer.enabled=e,e?(Clusterer.setMaxZoom(null),Clusterer.setGridSize(50)):(Clusterer.setMaxZoom(1),Clusterer.setGridSize(1)),Clusterer.resetViewport(),Clusterer.redraw(),void 0)},type:function(e){return void 0===e?Map.getMap().getMapTypeId():Map.getMap().setMapTypeId(e)}};